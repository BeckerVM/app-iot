const Category = require('../models').Category
const Device = require('../models').Device
const SubCategory = require('../models').SubCategory

exports.getCategories = async (req, res) => {
  try {
    const categories = await Category.findAll()
    const data = []
    
   for(let i = 0; i < categories.length; i++) {
     data.push({
       category: categories[i],
       subcategories: await categories[i].getSubcategories()
     })
   }

    res.json(data)

  } catch (error) {
    res.status(500).json(error)
  }
}

exports.getDevicesbySubcategory = async (req, res) => {
  const { subcategoryId } = req.params
  try {

    const subcategory = await SubCategory.findByPk(subcategoryId)
    const devices = await subcategory.getDevices()

    res.json(devices)

  } catch (error) {
    res.status(500).json({
      error
    })
  }
}

exports.getDeviceById = async (req, res) => {
  const { deviceId } = req.params
  try {
    const device = await Device.findByPk(deviceId)

    res.json(device)
  } catch (error) {
    res.status(500).json({
      error
    })
  }
}

exports.createDeviceBySubcategory = async (req, res) => {
  const { subcategoryId } = req.params
  try {
    const subcategory = await SubCategory.findByPk(subcategoryId)
    subcategory.createDevice({
      name: 'Micro Servo sg90',
      description: 'Servo MotoR',
      imageUrl: 'data:image/jpeg;base64,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'
    })

    res.json({
      success: true
    })
  } catch (error) {
    res.status(500).json({
      error
    })
  }
}